---
- name: Install locales
  apt:
    update-cache: yes
    name: locales
    state: present

- name: Update locale-gen configuration
  lineinfile:
    dest: /etc/locale.gen
    regexp: ^# en_US\.UTF-8 UTF-8$
    line: en_US.UTF-8 UTF-8
    backrefs: yes
  register: localegen

- stat: path=/usr/lib/locale/locale-archive
  register: localearchive

- name: Generate en_US.UTF-8 locale
  command: locale-gen --lang en_US.UTF-8
  when: localegen.changed or not localearchive.stat.exists

- name: Install mksh
  apt:
    update-cache: yes
    name: mksh
    state: present

- name: Remove BASH configuration
  file: path=~/{{ item }} state=absent
  with_items:
    - .bash_profile
    - .bashrc
    - .bash_history
    - .bash_logout
  sudo: yes
  sudo_user: "{{ primary_user }}"

- name: Set shell of primary user
  user: name="{{ primary_user }}" shell=/bin/mksh
